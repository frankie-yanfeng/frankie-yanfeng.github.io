---
layout:     post   				    # 使用的布局（不需要改）
title:      CMake 				# 标题
subtitle:   Build #副标题
date:       2019-11-12 				# 时间
author:     frankie 						# 作者
header-img: img/cmake_2.jpg 	#这篇文章标题背景图片
catalog: true 						# 是否归档
tags:								#标签
    - CMake
---

# Features
1. Open Source
2. Cross Platform
3. Fit for large project, e.g. KDE4
4. Simplified Tool Chain: cmake + make
5. Efficiency
6. Scalable

# Drawbacks
1. Not simple and stupid solution
2. CMake language and syntax
3. Not working well with pkgconfig

# Learning Tips
1. Practice and Project Driven
2. For simple project with just a few files, the Makefile is the best option
3. Use CMake for C/C++/Java only
4. For java, better use Maven/ant/Gradle

# Installation
1. Built-in installation in many Linux Distributions (may be not the latest version)
2. [Source Code Build](https://cmake.org/download/)

# First Trial with helloworld example

```c++
main.c 文件内容：
//main.c

#include <stdio.h>

int main()
{
  printf(“Hello World from t1 Main!\n”);
  return 0;
}
```

```
CmakeLists.txt 文件内容：
PROJECT (HELLO)
SET(SRC_LIST main.c)
MESSAGE(STATUS "This is BINARY dir " ${HELLO_BINARY_DIR})
MESSAGE(STATUS "This is SOURCE dir " ${HELLO_SOURCE_DIR})
ADD_EXECUTABLE(hello ${SRC_LIST})
```

![Imgur](https://i.imgur.com/06DvRtK.png)

# Basic Syntax
```
PROJECT(projectname [CXX] [C] [Java])

1. ${HELLO_BINARY_DIR}
2. ${HELLO_SOURCE_DIR}
3. ${PROJECT_SOURCE_DIR}
4. ${PROJECT_SOURCE_DIR}
```

```
SET(VAR [VALUE] [CACHE TYPE DOCSTRING [FORCE]])
e.g.
1. SET(SRC_LIST main.c)
2. SET(SRC_LIST main.c t1.c t2.c)
```

```
MESSAGE([SEND_ERROR | STATUS | FATAL_ERROR] "message to display"...)
1. SEND_ERROR, 产生错误，生成过程被跳过
2. SATUS, 输出前缀为--的信息
3. FATAL_ERROR, 立即终止所有cmake过程
```

```
ADD_EXECUTABLE(hello ${SRC_LIST})

ADD_EXECUTABLE(hello main.c func.c) or ADD_EXECUTABLE(hello main.c;func.c)
```

## Recap
1. Using ${} to refer variables, but in IF statement, variables are directly used without ${}
2. Command(para1 para2 ...) - parameters are separated by space or semicolon
3. Command is case insensitive, while parameters and variables are case sensitive. In practice, it is recommended to use all CAPITALS.
4. The project name in PROJECT() is not the generated executable file as ADD_EXECUTABLE()
5. SET(SRC_LIST main.c) == SET(SRC_LIST "main.c") {SET(SRC_LIST "fu nc.c")}
6. make clean
7. in-source build vs. out-of-source build (No impact on original source code folder)

```
-- This is BINARY dir /home/aiq/Downloads/cmake/t1/build
-- This is SOURCE dir /home/aiq/Downloads/cmake/t1
```

![Imgur](https://i.imgur.com/0XAHGi9.png)

# Out Of Source Build
```
mkdir ./t2/src

vim ./t2/src/CMakeLists.txt

ADD_EXECUTABLE(hello main.c)

---

vim ./t2/CMakeLists.txt

PROJECT(HELLO)
ADD_SUBDIRECTORY(src bin)

mkdir  ./t2/build
cmake ..
make
```

```
ADD_SUBDIRECTORY(source_dir [binary_dir] [EXCLUDE_FROM_ALL])
```

![Imgur](https://i.imgur.com/PULcy48.png)

# Reference
* [Cmake 实践](http://file.ncnynl.com/ros/CMake%20Practice.pdf)
